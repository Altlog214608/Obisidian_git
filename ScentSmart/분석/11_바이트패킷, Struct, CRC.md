# âœ… ì‹œë¦¬ì–¼ ë°”ì´íŠ¸ íŒ¨í‚·ê³¼ êµ¬ì¡°ì  ì´í•´

  

## 1. ë°”ì´íŠ¸ íŒ¨í‚·ì´ë€?

  

- **ë°”ì´íŠ¸ íŒ¨í‚·(byte packet)**ì€ í•˜ë“œì›¨ì–´(ì˜ˆ: scent ê¸°ê¸°)ì™€ í”„ë¡œê·¸ë¨ì´ **ì„œë¡œ ì£¼ê³ ë°›ëŠ” ëª…ë ¹/ë°ì´í„° ë¬¶ìŒ**ì…ë‹ˆë‹¤.

- 0~255ì˜ ê°’ì„ ê°–ëŠ” **í•œê¸€ì(byte, 8ë¹„íŠ¸)**ë“¤ì´ ì—°ì†ì ìœ¼ë¡œ ë°°ì—´ëœ "ì—°ì† ë©”ëª¨ë¦¬" ë¸”ëŸ­ í˜•íƒœì…ë‹ˆë‹¤.

- í•œ íŒ¨í‚·ì€ ë‹¤ìŒ êµ¬ì„±ìœ¼ë¡œ ì´ë£¨ì–´ì§(ì˜ˆì‹œ):

Â  ```

Â  [ì¥ì¹˜ID][ëª…ë ¹ì½”ë“œ][ì£¼ì†Œ][ì •ë³´][...][ì²´í¬ì„¬]

Â  ```

Â  (ê° í•„ë“œëŠ” 1~ëª‡ì‹­ ë°”ì´íŠ¸ë¡œ, í•˜ë“œì›¨ì–´ê°€ 'ìˆœì„œëŒ€ë¡œ ìª¼ê°œì„œ ì½ìŒ')

  

- **ëª©ì :** ê¸°ê³„ê°€ ì˜¤ë™ì‘ ì—†ì´, ì •í™•í•˜ê²Œ "ëª…ë ¹: ì´ëŸ° ë™ì‘ í•´!" ë˜ëŠ” "ë°ì´í„°: ê²°ê³¼ ì´ê±°ì•¼!"ë¥¼ ì „ë‹¬ë°›ê²Œ í•˜ë ¤ëŠ” ê²ƒ.

  

---

  

## 2. structì˜ ì—­í• 

  

- íŒŒì´ì¬ struct ëª¨ë“ˆì€ **ìˆ«ìÂ·ë¬¸ì ë“± ìë£Œí˜•ì„ 0~255ì˜ ë°”ì´íŠ¸ ì‹œí€€ìŠ¤ë¡œ ë³€í™˜**í•©ë‹ˆë‹¤.

- ì˜ˆ)

Â  - ìˆ«ì 4200 â†’ 16ì§„ìˆ˜ 0x1068 â†’ ë°”ì´íŠ¸: `\x10\x68`

Â  - `struct.pack(">H", 4200)` Â 

Â  Â  Â - **">"**: big-endian(í°ê°’ì´ ì•ìœ¼ë¡œ) ì •ë ¬

Â  Â  Â - **H**: unsigned short(2ë°”ì´íŠ¸)

Â  Â  Â - **ê²°ê³¼**: `b'\x10\x68'`

  

- ì´ ì‘ì—…ì´ í•„ìš”í•œ ì´ìœ ëŠ”, ì»´í“¨í„° ë‚´ë¶€ ìˆ«ì ìë£Œí˜•(ì˜ˆ: int)ì€ í•˜ë“œì›¨ì–´ë¼ë¦¬ ë‹¤ë¥´ê²Œ ì €ì¥ë  ìˆ˜ ìˆì–´, ë°”ì´íŠ¸ ë‹¨ìœ„ "í‘œì¤€ í¬ë§·"ìœ¼ë¡œ ë°”ê¿”ì•¼ ì¥ë¹„ì™€ 1:1 ëŒ€í™”ê°€ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸.

  

---

  

## 3. ì²´í¬ì„¬(CRC)ì˜ ì˜ë¯¸ì™€ ëª©ì 

  

- **ì²´í¬ì„¬(checksum)**, ê·¸ì¤‘ì—ì„œë„ **CRC(Cyclic Redundancy Check)**ëŠ”

Â  - **íŒ¨í‚·ì´ ì‹ í˜¸ê¸°ê¸°ì—ì„œ ê¸°ê¸°ê¹Œì§€ ì „ì†¡ë˜ëŠ” ë™ì•ˆ ì—ëŸ¬ ì—†ì´ ë„ì°©í–ˆëŠ”ì§€ ê²€ì¦**í•˜ëŠ” ìˆ«ì ì½”ë“œ(1~ìˆ˜ë°”ì´íŠ¸).

- **íŒ¨í‚· ë**ì— ë¶™ìŠµë‹ˆë‹¤. (ì˜ˆ: `[DATA..][ì²´í¬ì„¬2byte]`)

  

### CRC16 (MODBUS)ì˜ ì›ë¦¬

  

- **dsCommì—ì„œëŠ”** CRC-16 MODBUS ê·œê²© ì‚¬ìš© â†’ íŒ¨í‚· ë°”ì´íŠ¸ ì „ì²´ë¥¼ ê³µì‹ì— ì§‘ì–´ë„£ì–´ 2byte(16ë¹„íŠ¸) ìˆ«ìë¥¼ ë§Œë“¦

Â  - í•¨ìˆ˜: `crc16_modbus(0xFFFF, mdata, len(mdata))`

- í•˜ë“œì›¨ì–´ë„ ë˜‘ê°™ì´ ê³„ì‚°í•´ì„œ ë„ì°©í•œ ë©”ì‹œì§€ì˜ ì²´í¬ì„¬ì´ "ê³„ì‚°ê°’ê³¼ ì¼ì¹˜"í•˜ë©´ **ì •ìƒ**ìœ¼ë¡œ ì²˜ë¦¬, ì˜¤ë™ì‘Â·ë…¸ì´ì¦ˆ ì‹œ "ë²„ë¦¼" ì²˜ë¦¬.

  

**ì´ìœ :** ì‚°ì—…ì¥ë¹„ë‚˜ ì˜ë£Œê¸°ê¸°ì—ì„œëŠ” ì•„ì£¼ ì§§ì€ ìˆœê°„ì˜ ì˜¤ë¥˜ë„ í° ë¬¸ì œë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆì–´, ìë™ ê²€ì¦ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.

  

---

  

## 4. ì™œ 16ì§„ìˆ˜(HEX)ë¥¼ ì“°ëŠ”ê°€?

  

- ë°”ì´íŠ¸ íŒ¨í‚· í•˜ë‚˜í•˜ë‚˜ëŠ” 0~255(1byte, 8bit) ìˆ«ì â†’ **16ì§„ìˆ˜(2ê¸€ì)ë¡œ í‘œê¸°í•˜ë©´ ì‚¬ëŒì´ ì‰½ê²Œ êµ¬ë¶„í•˜ê³  ì½ìŒ**

Â  - ì˜ˆ) 10ì§„ìˆ˜ 10 = 0x0A, 255 = 0xFF

- í”„ë¡œí† ì½œÂ·íŒ¨í‚· ì„¤ëª…, ë””ë²„ê¹… ì½˜ì†” ë“±ì—ì„œ í•­ìƒ `0xAB 0xC1 ...` í˜•íƒœë¡œ ì¶œë ¥.

- ì—¬ëŸ¬ ë°”ì´íŠ¸ë¥¼ ì´ì–´ì„œ í‘œê¸°í•´ì•¼ í•  ë•Œë„ ì˜ ë§ì•„ë–¨ì–´ì§(1ë°”ì´íŠ¸=2ê¸€ì, 2ë°”ì´íŠ¸=4ê¸€ì).

- **í”„ë¡œê·¸ë˜ë°/í•˜ë“œì›¨ì–´ ì„¸ê³„ì—ì„œ ë°”ì´íŠ¸ ê°’ë“¤ì„ "í—¥ìŠ¤(byte hex)"ë¡œ ë³´ëŠ” ê²Œ í‘œì¤€!**

  

---

  

## 5. ì‹¤ì œ êµ¬ì„± ì˜ˆì‹œ (`dsComm.sendMsgForEmitClean`)

  

(1) ì…ë ¥ìœ¼ë¡œ "ë²ˆí˜¸/ì„¸ê¸°/ì‹œê°„/ë”œë ˆì´" ë“±ì˜ íŒŒë¼ë¯¸í„° ê°’ì„ ë°›ìŒ Â 

(2) ê° íŒŒë¼ë¯¸í„°ë¥¼ structë¡œ ë°”ì´íŠ¸ë¡œ í¬ì¥ Â 

(3) ëª¨ë“  ë°”ì´íŠ¸ë“¤ í•©ì¹œ ë’¤ Â 

(4) CRC16 ì²´í¬ì„¬(2byte) ì¶”ê°€ Â 

(5) **â†’ í•˜ë‚˜ì˜ íŒ¨í‚·(byte array) ì™„ì„± â†’ ì‹œë¦¬ì–¼ ì „ì†¡**

  

```python

# íŒ¨í‚· ìƒì„± ê³¼ì • í•µì‹¬ ë¼ì¸

mid = bytes([id])

mfunc = bytes([func])

maddress = struct.pack(">H", address)

# ... ê°ì¢… í•„ë“œ ìƒëµ ...

mdata = mid + mfunc + maddress + ... + mdata_cleanup_delay

wdata = mdata + crc16_modbus(0xFFFF, mdata, len(mdata))

```

  

- **ê²°ê³¼ë¬¼ `wdata`:** "ì´ ì¥ì¹˜ì•¼, ì´ ë™ì‘(ëª…ë ¹/ê°’) í•´! (ë§ˆì§€ë§‰ì— CRC ë¶™ì„)"

  

---

  

## âœ… ìš”ì•½ ì •ë¦¬

  

| í•­ëª© Â  Â  | í•µì‹¬ ìš”ì•½ |

|--------|----------|

| ë°”ì´íŠ¸ íŒ¨í‚· | ì¥ì¹˜ ê°„ í†µì‹ ìš© ë°ì´í„° ë¬¶ìŒ (ë°”ì´íŠ¸ ë‹¨ìœ„ ì •ë ¬) |

| struct | ë°ì´í„°ë¥¼ ë°”ì´íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” ë„êµ¬ (í†µì‹  í˜¸í™˜ìš©) |

| CRC16 | ì „ì†¡ ì—ëŸ¬ë¥¼ ìë™ ê²€ì¶œí•˜ëŠ” ê²€ì¦ ìˆ«ì |

| HEX í‘œê¸° | ë°”ì´íŠ¸ ë‹¨ìœ„ë¥¼ ì‚¬ëŒì´ ë³´ê¸° ì‰½ê²Œ í‘œí˜„í•˜ëŠ” ë°©ë²• |


## âœ… struct íŒ¨í‚¹ ì„¤ëª…

|ì¸ì|êµ¬ì¡° (Hex)|ì„¤ëª…|
|---|---|---|
|id=1|0x01|ì¥ì¹˜ë²ˆí˜¸|
|func=6|0x06|ëª…ë ¹ì½”ë“œ(ë‹¨ì¼ì“°ê¸°)|
|address=4212|0x10 74|ë ˆì§€ìŠ¤í„° ì£¼ì†Œ(2ë°”ì´íŠ¸)|
|command=400|0x01 90|ì¨ì¤„ê°’(2ë°”ì´íŠ¸)|
|crc16|0xCC EC|MODBUS CRC ì²´í¬ì„¬|

- **ì´ 8ë°”ì´íŠ¸**
    
- ê° ê°’ì€ structë¡œ ë³€í™˜/í¬ì¥(ì˜ˆ: `struct.pack(">H", address)`)
    

## ğŸ·ï¸ MODBUS, ë ˆì§€ìŠ¤í„°, CRC16ì´ë€?

- **MODBUS**: ì‚°ì—…ìš© êµ­ì œ í†µì‹  ê·œê²©, 1~Nê°œ ì¥ì¹˜ê°€ ì£¼ì†Œ(ID), ëª…ë ¹ì½”ë“œ, ì£¼ì†Œ, ë°ì´í„°, CRC ê·œê²©ì— ë”°ë¼ ì •ë³´ë¥¼ ì£¼ê³ ë°›ìŒ.
    
- **ë ˆì§€ìŠ¤í„°**: í•˜ë“œì›¨ì–´ ë‚´ë¶€ì˜ â€œì‘ì€ ê¸°ì–µì¹¸(ì£¼ì†Œ ìˆëŠ” ë³€ìˆ˜)â€ë¡œ, ëª…ë ¹/ì„¼ì„œ/ìƒíƒœ ê°’ ì €ì¥
    
- **CRC16**: ë°ì´í„° ì „ì†¡ ì¤‘ ì˜¤ë¥˜ ê²€ì¶œ ìœ„í•œ 2ë°”ì´íŠ¸ ì²´í¬ì„¬ (ë¹ ë¥¸ ê³„ì‚° ìœ„í•´ crc16_table í™œìš©)
    

## âœ… CRC16 ê³„ì‚° ì•„ì´ë””ì–´ (ì½”ë“œ ì˜ˆì‹œ)

python

`def crc16_modbus(init_crc, dat, length):     crc = [init_crc >> 8, init_crc & 0xFF]    for b in dat:        tmp = crc16_table[crc[0] ^ b]        crc[0] = (tmp & 0xFF) ^ crc[1]        crc[1] = tmp >> 8    return struct.pack("H", (crc[1] << 8) | crc[0])`

- **crc16_table**: ê³„ì‚° íš¨ìœ¨í™”ìš© precomputed 256 ì—”íŠ¸ë¦¬ í…Œì´ë¸”
    
    
    