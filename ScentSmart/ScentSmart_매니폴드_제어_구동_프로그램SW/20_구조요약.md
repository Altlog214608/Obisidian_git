

## âœ… **ì‹¤ì œ êµ¬ì¡° ìš”ì•½**

- **SW(PC ì†Œí”„íŠ¸ì›¨ì–´, UI/ì•±) ì—­í• **
    
    - ëŒ€ë¶€ë¶„ì˜ ë™ì‘(ë¬¸ì œ ì¶œì œ, UI ì „í™˜, ê²°ê³¼ì§‘ê³„, ì—‘ì…€ ì €ì¥, ì‚¬ìš©ì ì•ˆë‚´ ë“±)ì€ SW ë‚´ë¶€ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
        
    - ë°œí–¥(ë¶„ì‚¬), ì„¸ì •(í´ë¦¬ë‹), ì •ì§€(ìŠ¤í†±) ë“± ì§ì ‘ í•˜ë“œì›¨ì–´ì™€ ê´€ë ¨ëœ ê¸°ëŠ¥ì´ í•„ìš”í•  ë•Œë§Œ
        
        - ë°”ì´íŠ¸ íŒ¨í‚·(ëª…ë ¹+íŒŒë¼ë¯¸í„°ë“¤: í–¥ë²ˆí˜¸, ì‹œê°„, ì„¸ê¸° ë“±)ì„ ë§Œë“¤ì–´ ì‹œë¦¬ì–¼ë¡œ íŒì›¨ì–´ì— "OOí•´ì¤˜"ë¼ê³  ëª…ë ¹ì„ ë‚´ë¦½ë‹ˆë‹¤.
            
- **íŒì›¨ì–´(MCU) ì—­í• **
    
    - ìƒìœ„(SW)ì—ì„œ ëª…ë ¹ì´ ë“¤ì–´ì˜¬ ë•Œê¹Œì§€ ëŒ€ê¸°
        
    - ëª…ë ¹ì„ ë°›ìœ¼ë©´ ì‹¤ì œ í•˜ë“œì›¨ì–´(ë°¸ë¸Œ, íŒí”„, ëª¨í„° ë“±)ë¥¼ ì œì–´í•´ ë¶„ì‚¬/ì„¸ì •/ì •ì§€/ìƒíƒœ ë³€í™” ìˆ˜í–‰
        
    - ëª…ë ¹ì´ ëë‚˜ë©´ "ìˆ˜í–‰ì™„ë£Œ", "ìƒíƒœê°’", "ì—ëŸ¬" ë“± ê²°ê³¼ë§Œ SWì— ì‘ë‹µ íŒ¨í‚·ìœ¼ë¡œ ë¦¬í„´
        
    - íŠ¹ë³„í•œ ì„¼ì„œ ì´ë²¤íŠ¸(ì˜ˆ: ì—ëŸ¬, ì´ìƒìƒí™©, ì„¼ì„œê°’ ë³€í™”)ë‚˜ ì£¼ê¸°ì  ìƒíƒœ ë³´ê³  ë“±ë„ í•„ìš”ì‹œ ë°˜í™˜
        

## ğŸ”µ **ì¦‰, í•µì‹¬ í†µì‹  íë¦„**

1. **SW:** ëª…ë ¹ í•„ìš” ì‹œ(ë¶„ì‚¬/ì„¸ì •/ì •ì§€) â†’ [ë°”ì´íŠ¸ íŒ¨í‚· ì „ì†¡]
    
2. **íŒì›¨ì–´:** ëª…ë ¹ ë°›ìŒ â†’ ì‹¤ì œ ë¶„ì‚¬/ì„¸ì • ë™ì‘ â†’ ê²°ê³¼/ìƒíƒœ/ì—ëŸ¬ê°’ë§Œ [íŒ¨í‚·ìœ¼ë¡œ ì‘ë‹µ]
    

- ë‚˜ë¨¸ì§€ ëª¨ë“  UI í™”ë©´/ê²°ê³¼ ì €ì¥/ë¡œê·¸/UI ìƒíƒœ ì „í™˜ ë“±ì€ **SW ë‚´ë¶€ì—ì„œ ìì²´ ì²˜ë¦¬**í•˜ë©°
    
- íŒì›¨ì–´ëŠ” ë”± "ë¬¼ë¦¬ ë™ì‘"(ì‹¤í–‰/ì œì–´/ì¢…ë£Œ/ìƒíƒœë³´ê³ )ì— ì§‘ì¤‘, "ëª…ë ¹ë°›ê³ -ìˆ˜í–‰í•˜ê³ -ê²°ê³¼ì•Œë¦¼"ë§Œ ë°˜ë³µ
    

## ğŸŸ¢ **ê²°ë¡  (ì‰½ê²Œ í•œ ì¤„ë¡œ):**

> **ë¶„ì‚¬ì™€ ì„¸ì •ì²˜ëŸ¼ ì‹¤ì œ í•˜ë“œì›¨ì–´ ë™ì‘ì´ í•„ìš”í•  ë•Œë§Œ SWâ†”íŒì›¨ì–´ í†µì‹ ì´ ì˜¤ê°€ê³ , ë‚˜ë¨¸ì§€ ëª¨ë“  UI, ê²€ì‚¬ íë¦„, ë°ì´í„°ê´€ë¦¬ëŠ” SW(ì•±) ë‚´ë¶€ì—ì„œë§Œ ì²˜ë¦¬ëœë‹¤!**

ì•„ë˜ëŠ” ì‹œë¦¬ì–¼(Câ†”Python) í†µì‹ ì—ì„œ ê° í•¨ìˆ˜, ê° ë²„í¼, ì‹¤ì œ ë°”ì´íŠ¸ ë°ì´í„°ê°€ ì–´ë–»ê²Œ ì˜¤ê°€ëŠ”ì§€ êµ¬ì¡°ì ìœ¼ë¡œ ì‰½ê²Œ ì„¤ëª…í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

# 1. **í†µì‹  ê¸°ë³¸ êµ¬ì¡°**

- **Python**: PCì—ì„œ ë°”ì´íŠ¸(ëª…ë ¹, ê°’ ë“±) ë¬¶ìŒì„ ì‹œë¦¬ì–¼(USB to RS232 ë“±)ì„ í†µí•´ ë³´ëƒ„
    
- **MCU/íŒì›¨ì–´(C)**: ì‹œë¦¬ì–¼ í¬íŠ¸ì— ë°”ì´íŠ¸ê°€ ë„ì°©í•˜ë©´ ë²„í¼ì— ì €ì¥ â†’ í•„ìš”í•œ í•¨ìˆ˜ë“¤ì´ ì´ë¥¼ êº¼ë‚´ ì²˜ë¦¬
    

# 2. **ì£¼ìš” í•¨ìˆ˜ì™€ ë°ì´í„° ë²„í¼ ì—­í• **

## (1) **C(íŒì›¨ì–´)ë‹¨ - êµ¬ì¡°ì²´ì™€ í•¨ìˆ˜**

## **a. s_SERIAL êµ¬ì¡°ì²´**



```c
struct s_SERIAL {     
unsigned char read[SIZEBUFFER], send[SIZEBUFFER];    
int sendbyte, readbyte;    
int port, baudrate, parity, databits, stopbits, error;    
double timeout;    
char flagopen;    
char starter, terminator;    
int protocol, crc;    
int mode, debug;    
int add; };
```

- **read[]**: ì‹œë¦¬ì–¼ "ìˆ˜ì‹ " ë°ì´í„° ì €ì¥ (Pythonì—ì„œ ì˜¨ ë°”ì´íŠ¸ë“¤)
    
- **send[]**: ì‹œë¦¬ì–¼ "ì†¡ì‹ " ë°ì´í„° ì €ì¥ (MCUì—ì„œ Python/PCë¡œ ë³´ë‚´ëŠ” ë°”ì´íŠ¸ë“¤)
    
- **readbyte/sendbyte**: ì‹¤ì œ ìˆ˜ì‹ /ì†¡ì‹  ë°”ì´íŠ¸ ê°œìˆ˜(=payload size)
    
- ê¸°íƒ€ ë³€ìˆ˜: í¬íŠ¸ ì„¸íŒ…, í†µì‹ ì—ëŸ¬ ì •ë³´, ì²´í¬ëª¨ë“œ ë“±
    

## **b. Pythonâ†’C ë°ì´í„° íë¦„ í•¨ìˆ˜**

## **1) InstallComCallback & ComCallback**

- ì´ë²¤íŠ¸ ê¸°ë°˜ ìˆ˜ì‹ ìš© ì½œë°± ì§€ì •
    
- ë°ì´í„°ê°€ ë„ì°©í•  ë•Œë§ˆë‹¤ ìë™ í˜¸ì¶œí•´ ì•„ë˜ **ReadFromCom()** ì‹¤í–‰
    

## **2) ReadFromCom()**

- ì‹¤ì œë¡œ read ë²„í¼(ì¦‰, scom->read)ë¡œ ë°ì´í„° ë³µì‚¬
    
- terminator ë°©ì‹(ë¬¸ì ê¸°ì¤€ìœ¼ë¡œ ëŠê¹€) or ê¸¸ì´ë§Œí¼ ë‹¤ ì½ê¸°
    
- ì½ì€ í›„ scom->readbyteì— ì €ì¥
    

## **3) DecodePacket()**

- **read[]**ì— ë‹´ê¸´ ë°”ì´íŠ¸(ì˜ˆ: ëª…ë ¹ì–´, ê°’ ë“±)ë¥¼ íŒŒì‹±í•´ì„œ ëª…ë ¹ ì‹¤í–‰  
    ì˜ˆ) s_serial.read=ID, s_serial.read[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/6ea26fc2-9e2b-43eb-9434-7d868e463f83/ConfigCOM.c)=ëª…ë ¹, .../ì„¼ì„œë°ì´í„°, ...
    
- ëª…ë ¹ì— ë”°ë¼ ëª¨í„°, ì„¼ì„œ ë“± í•˜ë“œì›¨ì–´ ì œì–´í•˜ê±°ë‚˜ ì‘ë‹µ íŒ¨í‚· ìƒì„±
    

## **4) SendToCom()**

- send[] ë²„í¼ì— ë°ì´í„° ë‹´ì•„ PCë¡œ ì „ì†¡
    
- CRC ë“± í›„ì²˜ë¦¬(ë¶™ì´ê¸°) í›„ ComWrt ë“±ìœ¼ë¡œ ì‹¤ì œ ì „ì†¡
    

## (2) **Python ë‹¨ - í•¨ìˆ˜ì™€ ë°ì´í„°**

## **dsComm.py, FrSmart.py ë“±**

- `sendMsgForEmitClean()`, `sendMsgReadRegister()` ë“±ì—ì„œ struct.pack ë“±ìœ¼ë¡œ payload ìƒì„±
    
- ì‹œë¦¬ì–¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ .write() í•˜ë©´ ê·¸ ê°’ì´ ë°”ë¡œ Cë¡œ ì „ë‹¬
    

## **ì˜ˆì‹œ ì½”ë“œ**

python

```python
# sendMsgForEmitClean ì˜ˆë¥¼ ë“¤ì–´ 
payload = mid + mfunc + maddress + ... + mdata_cleanup_delay payload += crc16_modbus(0xFFFF, payload, len(payload)) serial.write(payload)
```

â†’ C read[]ë¡œ ë“¤ì–´ê°

# 3. **ë°”ì´íŠ¸ ë‹¨ìœ„ ì‹¤ì œ ë°ì´í„° ì˜¤ê³ ê° (ì˜ˆì‹œ)**

## (1) Pythonì—ì„œ ë³´ë‚¼ ë•Œ

- payload = [ID, ëª…ë ¹, ë ˆì§€ìŠ¤í„°ì£¼ì†Œ, ê°’1(high), ê°’1(low), ê°’2(high) ... CRC1 CRC2]
    
    - ex: [0x01, 0x10, 0x10, 0x68, ... ë°”ì´íŠ¸ë“¤, CRC LSB, CRC MSB]
        
- ì´ê±¸ ì§ë ¬ ì†¡ì‹ 
    

## (2) Cì—ì„œ ë°›ì„ ë•Œ

- read = 0x01 (ID)
    
- read[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/6ea26fc2-9e2b-43eb-9434-7d868e463f83/ConfigCOM.c) = 0x10 (ëª…ë ¹ ì½”ë“œ)
    
- read[2](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/e4f528e1-73e2-4306-9af6-7bd10a292b6c/ConfigCOM.h)~... = ë°ì´í„° ë°”ì´íŠ¸ë“¤
    
- read[] ìµœí›„ë‹¨ = CRC ë°”ì´íŠ¸ë“¤ (ë¬´ê²°ì„± ê²€ì‚¬ìš©)
    

**â†’ í•¨ìˆ˜ íë¦„**  
(PCì—ì„œ write)  
â†’(MCU ì½œë°±)â†’ReadFromCom(read[])â†’DecodePacket(read[] í•´ì„)â†’ë™ì‘(íŒí”„ êµ¬ë™, ì‘ë‹µ ì†¡ì‹  ë“±)

# 4. **CRC/ë¬´ê²°ì„± ê²€ì‚¬ ë° ì†¡ì‹ /ì‘ë‹µ**

- **CheckCRC16, CheckModbusCRC**: ë“¤ì–´ì˜¨ ë°”ì´íŠ¸ê°€ ê¹¨ì¡ŒëŠ”ì§€, ë³€ì¡° ì—†ëŠ”ì§€ í™•ì¸
    
- **AttachCRC16, AttachModbusCRC**: MCUì—ì„œ ì‘ë‹µ ë³´ë‚¼ ë•Œ CRC ë°”ì´íŠ¸ ë¶™ì—¬ì¤Œ
    
- í†µì‹  ë¬¸ì œì‹œ ErrorCom() ë“±ìœ¼ë¡œ ì½”ë“œ ë° ë©”ì‹œì§€ ë„ì›€
    

# 5. **ìµœì¢… ë™ì‘ ìš”ì•½**

|ë‹¨ê³„|í•˜ëŠ” ì¼|
|---|---|
|Pythonì—ì„œ ë°”ì´íŠ¸ íŒ¨í‚· ìƒì„±|struct.pack, bytes ë“± ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” ëª…ë ¹/ê°’ íŒ¨í‚¹, CRC ë¶™ì´ê³  ì†¡ì‹ |
|Cì—ì„œ read[]ì— ë°ì´í„° ìˆ˜ì‹ |ReadFromCom()ì—ì„œ ë²„í¼ì— ë³µì‚¬, ë°”ì´íŠ¸ìˆ˜ ì €ì¥|
|CRC ê²€ì‚¬(ë°ì´í„° ë³€ì¡° ì²´í¬)|CheckCRC* í•¨ìˆ˜ë¡œ ë¬´ê²°ì„± ê²€ì‚¬|
|ë°ì´í„° í•´ì„ ë° ëª…ë ¹ ì‹¤í–‰|DecodePacket()ì—ì„œ read[] ê°’ëŒ€ë¡œ ì‹¤êµ¬ë™(ëª¨í„° ë“±) ë˜ëŠ” ì‘ë‹µ ì¤€ë¹„|
|MCUì—ì„œ PCë¡œ ì‘ë‹µ ë³´ëƒ„|send[]ì— ê°’/ìƒíƒœ ë‹´ì•„ CRC ë¶™ì—¬ SendToCom()ë¡œ ì†¡ì‹ |

# 6. **ì‹¤ì „ íŒ**

- **read[]/send[]**ëŠ” í•­ìƒ íŒ¨í‚· ê·¸ëŒ€ë¡œ(ë°”ì´íŠ¸ ë‹¨ìœ„) ë“¤ì–´ì˜¤ê³  ë‚˜ê°
    
- ê° í•¨ìˆ˜ëŠ” ì¤‘ê°„ì¤‘ê°„ ë°”ì´íŠ¸ ìˆ˜ ê²€ì‚¬(`readbyte`, `sendbyte`), CRC ê²€ì‚¬ í•„ìˆ˜
    
- ì‹¤ì œ ë™ì‘(ëª¨í„°, ì„¼ì„œ ì œì–´ ë“±)ì€ DecodePacketì—ì„œ ë¶„ê¸° ì²˜ë¦¬
    

í•„ìš”í•˜ë‹¤ë©´ ê° êµ¬ì¡°/í•¨ìˆ˜ê°€ í•´ì„í•˜ëŠ” íŒ¨í‚· í¬ë§· ì˜ˆì‹œ, ë°”ì´íŠ¸ë³„ ì˜ë¯¸ê¹Œì§€ ë” ì„¤ëª… ê°€ëŠ¥í•©ë‹ˆë‹¤!

1. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/6ea26fc2-9e2b-43eb-9434-7d868e463f83/ConfigCOM.c](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/6ea26fc2-9e2b-43eb-9434-7d868e463f83/ConfigCOM.c)
2. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/e4f528e1-73e2-4306-9af6-7bd10a292b6c/ConfigCOM.h](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/e4f528e1-73e2-4306-9af6-7bd10a292b6c/ConfigCOM.h)
3. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/311793f0-00ec-4937-9ab1-0ca0be611e23/ControlPumpNF.c](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/311793f0-00ec-4937-9ab1-0ca0be611e23/ControlPumpNF.c)
4. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/50ffaa46-660c-4eee-ac44-5a3b310f5c38/ControlPumpNF.h](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/50ffaa46-660c-4eee-ac44-5a3b310f5c38/ControlPumpNF.h)
5. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/f4b9368d-2bbe-4c48-8f5f-77356ed069f0/FunctionSerial.c](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/f4b9368d-2bbe-4c48-8f5f-77356ed069f0/FunctionSerial.c)
6. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/4c6a2472-7ee6-48a7-baa6-d98a97a1657d/FunctionSerial.h](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/4c6a2472-7ee6-48a7-baa6-d98a97a1657d/FunctionSerial.h)
7. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/0734a919-c2fc-4105-b173-48625c60b5f3/MODBUS.c](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/0734a919-c2fc-4105-b173-48625c60b5f3/MODBUS.c)
8. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/ad82efcb-cc4e-43b2-839c-0603955dc00e/MODBUS.h](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/ad82efcb-cc4e-43b2-839c-0603955dc00e/MODBUS.h)
9. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/11dbb366-8707-4401-ae96-0b74a041019d/dsComm.py](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/11dbb366-8707-4401-ae96-0b74a041019d/dsComm.py)
10. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/d9dac957-04db-41bb-af5e-2f6c9baf3bbc/FrSmart.py](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/d9dac957-04db-41bb-af5e-2f6c9baf3bbc/FrSmart.py)