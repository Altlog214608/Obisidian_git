결과 화면에서 **엑셀 저장**, **차트 확인** 기능과, **DB 관련 코드** 위치는 다음과 같습니다.

## 1. 결과 화면에서 엑셀 저장 기능

## 엑셀 저장의 진입점

- 결과 화면의 버튼 클릭 시 `uiTestResultsSave`, `uiTestThresholdResultsConfirm`, `uiTestDiscriminationResultsConfirm`, `uiTestIdentificationResultsConfirm`, 등에서 파일로 저장하는 메서드가 호출됩니다.
    

## 실제 엑셀 파일 저장 함수

## - 역치 검사 결과 저장:

python

`def saveDataThreshold(self):     ...    workbook = xlsxwriter.Workbook(save_file)    worksheet = workbook.add_worksheet()    # for 루프에서 결과 테이블 데이터 기록    # 점수, 타이틀, 차트 작성 등    chart = workbook.add_chart({'type': 'line'})    ...    worksheet.insert_chart('J3', chart, {'x_offset': 5, 'y_offset': 5})    workbook.close()`

## - 식별 검사 결과 저장:

python

`def saveDataDiscrimination(self):     ...    workbook = xlsxwriter.Workbook(save_file)    worksheet = workbook.add_worksheet()    # 데이터 기록    chart = workbook.add_chart({'type': 'pie'})    ...    worksheet.insert_chart('I4', chart, {'x_offset': 5, 'y_offset': 5})    workbook.close()`

## - 인지 검사 결과 저장:

python

`def saveDataIdentification(self):     ...    workbook = xlsxwriter.Workbook(save_file)    worksheet = workbook.add_worksheet()    chart = workbook.add_chart({'type': 'pie'})    ...    worksheet.insert_chart('F4', chart, {'x_offset': 5, 'y_offset': 5})    workbook.close()`

## - 종합 결과 저장:

python

`def saveDataResults(self):     ...    # 여러 시트 포함, 각종 차트(라인, 파이) 생성 및 저장    workbook = xlsxwriter.Workbook(save_file)    worksheet_main = workbook.add_worksheet(dsText.reportText['report_sheet'])    # 점수와 기록, 차트 생성 및 포함    workbook.close()`

## 2. 차트 확인 기능

## 차트 위젯 활용

- 결과 화면(예: TDI 통합, 역치, 식별, 인지 등)의 UI에는 각각 차트 위젯이 연결되어 있습니다.
    
- 표에 데이터 추가 후, 다음 메서드들로 차트를 UI에서 업데이트:
    

python

`self.ui_test_results.widgetChartT.applyLineChart(T_chart_x, T_chart_y)    # 역치 라인 차트 self.ui_test_results.widgetChartD.applyPieChart(D_count_not_correct, D_count_correct)    # 식별 파이 차트 self.ui_test_results.widgetChartI.applyPieChart(I_count_not_correct, I_count_correct)    # 인지 파이 차트`

- 엑셀 저장 시에도 분석 자료와 동일한 데이터를 `.xlsx` 내에 차트로 함께 기록.
    

## 3. DB 관련 코드

## DB 생성 및 사용

## - DB 구조 생성

python

`def uiDlgDB(self):     dsTestDB.createTableSubject()    dsTestDB.createTableTestID()`

- 프로그램 초기화 시 각종 데이터를 저장할 테이블을 생성합니다. (`dsTestDB`, `dsTrainSTDB` 등)
    

## - 자가 훈련(Self Training) 결과 저장 예시:

python

`def uiTrainSTResponseNext(self):     if self.ui_train_st_response.hs_selfcheck.value() > 0:        dsTrainSTDB.insertCurrentTable(            dsTrainST.st_train_data[dsTrainST.st_train_index]['name'],            self.ui_train_st_response.hs_selfcheck.value()        )        self.makeTrainSTResults()        ...`

## - 훈련 결과 조회:

python

`def makeTrainSTResults(self):     data_all = dsTrainSTDB.selectAllFromTable()    # 결과 표, 차트 생성`

## DB 관련 모듈

- `dsTestDB`, `dsTrainSTDB`, `dsTestID`, 등은 내부적으로 sqlite 혹은 유저 메이드 DB를 통해 검사/훈련 데이터를 Table로 저장 및 조회하는 역할을 함.
    

## 요약

- **엑셀 저장 및 차트 기능:**
    
    - 결과 화면(검사 완료 후)에 대해 각각 `saveDataThreshold`, `saveDataDiscrimination`, `saveDataIdentification`, `saveDataResults` 등에서 xlsxwriter로 엑셀+차트를 저장함.
        
    - UI상의 차트는 `widgetChart.*Chart()` 계열 함수로 보여줌.
        
- **DB 관련 코드:**
    
    - 초기화 시 `uiDlgDB`에서 DB 테이블 생성.
        
    - 훈련 및 검사 결과는 각각의 insert/select 함수(`dsTrainSTDB.insertCurrentTable`, `selectAllFromTable` 등)로 저장 및 로딩.
        

모든 관련 내용은 ScentSmart.py 파일 하단과 각 검사별 처리 함수 안에 포함되어 있습니다[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/e249a23a-8e87-41cd-b84d-16c117c8e6b3/ScentSmart.py).

1. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/e249a23a-8e87-41cd-b84d-16c117c8e6b3/ScentSmart.py](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/e249a23a-8e87-41cd-b84d-16c117c8e6b3/ScentSmart.py)