---
aliases:
  - "35_데이터 송수신 구조: 꼭 이해해야 할 포인트"
---
두 파일(dsComm.py, FrSmart.py)은 Python으로 MCU(임베디드 장비)와 시리얼 통신을 할 때 **“명령 바이트패킷 생성/전송”** 및 **UI 상 제어 흐름**을 담당합니다.  
아래에 반드시 알아야 하는 부분과 중요 포인트를 초점별로 정리합니다.

# 1. **데이터 송수신 구조: 꼭 이해해야 할 포인트**

## 1) MCU로 “명령”을 보낼 때 바이트 패킷 구조

예시 함수: `sendMsgForEmitClean()` (dsComm.py)

- 실제 전송 바이트 구조:
    
    text
    
    `[ID][FUNC][ADDR_H][ADDR_L][QOR_H][QOR_L][LEN][CMD_H][CMD_L] [SCENT_NO_H][SCENT_NO_L][SCENT_PWR_H][SCENT_PWR_L][CLEAN_PWR_H][CLEAN_PWR_L] [SCENT_PERIOD_H][SCENT_PERIOD_L][CLEAN_PERIOD_H][CLEAN_PERIOD_L] [SCENT_DELAY_H][SCENT_DELAY_L][CLEAN_DELAY_H][CLEAN_DELAY_L] [CRC_LO][CRC_HI]`
    
- 각 필드는 1~2바이트, big-endian(>H) 포맷 사용
    
- 마지막 2바이트는 CRC16(Modbus 표준, 0xFFFF 시드)
    
- 모든 값은 bytes 객체로 구성되어 `.write()`로 직렬 송신
    

## 실제 사용 예 – 발향·세정 통합 명령

python

`wdata = mdata + crc16_modbus(0xFFFF, mdata, len(mdata)) serial.write(wdata)`

## 2) FrSmart.py에서의 통신 흐름(이벤트 기반)

- UI에서 ‘발향/세정’ 등 버튼 클릭 →
    
- 내부적으로 `requestScentWithValues()` 혹은 `requestScentNo()` 등 호출 →
    
- 파라미터(향 번호, 파워, 시간 정보 등)가 dsComm의 sendMsgForEmitClean() 같은 함수로 전달
    
- 명령 바이트 패킷 생성(sendMsg~ 함수)
    
- 최종적으로 `write_data()`에서 시리얼로 전송
    
- dsSerial.SerialReadThread로 수신 쓰레드가 데이터 읽어서
    
- 파싱 후 UI 및 상태 갱신
    

# 2. **Python 개발자로서 "꼭" 공부해야 할 범위**

## 반드시 필요한 부분 (“입출력 명령만 파이썬에서 다루는 경우” 기준)

1. **장비와 프로토콜 구조**
    
    - MCU가 요구하는 패킷의 “순서/데이터 타입/엔디안” 등 포맷 필수 숙지
        
    - 명령/응답 코드의 의미(예: emit, clean, stop, 읽기/쓰기 구분)
        
    - CRC16 계산법(코드 구현은 가져와서, “어떤 구간에 어떻게 붙이는가” 개념적 이해)
        
2. **Python에서 정확히 바이트 생성/해석**
    
    - struct.pack/unpack, bytes 연결법 확실하게 익히기
        
    - int/float/bool 값을 실제 프로토콜 맞게 바이너리로 바꿔 넣는 법
        
3. **에러상황/타임아웃 처리**
    
    - 장비에서 “아무 응답이 없음(통신 오류, CRC mismatch, 장치 busy)” 등 특수 상황 식별
        
    - 시리얼 예외 처리/재시도 로직(FrSmart pyqt UI에서 어떻게 처리할지 시나리오 설계)
        
4. **필요시, MCU(C 펌웨어)에서의 “명령 해석 루틴”까지 톱니 맞추기**
    
    - 신규 명령 혹은 패킷 구조 바꿔야 할땐 C에서 해당 부분 코드도 찾아볼 역량
        
    - 예를 들어, 명령 바이트 추가/삭제할 때 임베디드 단의 파싱위치, CRC 구간 검증 등은 확인해야 함
        

# 3. **꼭 알면 좋은 추가 포인트**

- MCU 시리얼 프로토콜 문서(바이트별 의미/명령테이블/예상 응답값) 한글/영문 버전 확보
    
- 실제 파이썬 → MCU → 파이썬 “왕복” 예제(직렬 로그 캡처 등) 하나 만들어서,  
    **패킷 인코딩/디코딩**이 제대로 되는지 확인
    
- 통신상 사용되는 모든 필드를 리스트로 정리(누락/잘못 해석 방지),  
    예를 들어 scent_power, scent_period, delay_time 등
    

# 4. **결론: 얼마나 공부하면 될까?**

- 아래 3가지는 반드시 완벽히 숙지해야 합니다.
    
    1. **내가 어떤 명령/값을 보내고, 어떤 구조로 응답을 받는가(패킷/프로토콜 매핑)**
        
    2. **파이썬에서 struct/bytes/CRC 다루는 방법과 패킷 생성/파싱 스킬**
        
    3. **MCU 펌웨어 코드에서 “내가 다루는 명령” 인식하는 루틴의 흐름만 읽을 수 있는 역량**  
        (필요시 C에서 해당 “case문/if문/레지스터 저장” 등 명령별 동작 코드를 파악하는 수준)
        
- **이 이상(하드웨어 드라이버, 실시간 인터럽트, C언어 OS 구현 등)은 필수는 아니지만**  
    실전 장애(이상 현상)시 C 코드 일부를 볼 수 있으면 진단/문서교신이 훨씬 쉬워집니다.
    

## 아주 요약해보면

**패킷구조, CRC, 바이너리 인코딩/디코딩, 명령표를 숙지하고  
파이썬 코드-펌웨어 명령루틴 “끼리끼리 맞추는 법”만 집중하면 현업 개발에 필요한 준비는 충분합니다!**  
이해가 어려운 실제 케이스, 예제, 전송 로그 등 언제든 요청하시면 구체적으로 파악 도와드릴 수 있습니다.

1. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/6ea26fc2-9e2b-43eb-9434-7d868e463f83/ConfigCOM.c](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/6ea26fc2-9e2b-43eb-9434-7d868e463f83/ConfigCOM.c)
2. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/e4f528e1-73e2-4306-9af6-7bd10a292b6c/ConfigCOM.h](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/e4f528e1-73e2-4306-9af6-7bd10a292b6c/ConfigCOM.h)
3. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/311793f0-00ec-4937-9ab1-0ca0be611e23/ControlPumpNF.c](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/311793f0-00ec-4937-9ab1-0ca0be611e23/ControlPumpNF.c)
4. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/50ffaa46-660c-4eee-ac44-5a3b310f5c38/ControlPumpNF.h](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/50ffaa46-660c-4eee-ac44-5a3b310f5c38/ControlPumpNF.h)
5. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/f4b9368d-2bbe-4c48-8f5f-77356ed069f0/FunctionSerial.c](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/f4b9368d-2bbe-4c48-8f5f-77356ed069f0/FunctionSerial.c)
6. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/4c6a2472-7ee6-48a7-baa6-d98a97a1657d/FunctionSerial.h](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/4c6a2472-7ee6-48a7-baa6-d98a97a1657d/FunctionSerial.h)
7. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/0734a919-c2fc-4105-b173-48625c60b5f3/MODBUS.c](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/0734a919-c2fc-4105-b173-48625c60b5f3/MODBUS.c)
8. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/ad82efcb-cc4e-43b2-839c-0603955dc00e/MODBUS.h](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/ad82efcb-cc4e-43b2-839c-0603955dc00e/MODBUS.h)
9. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/11dbb366-8707-4401-ae96-0b74a041019d/dsComm.py](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/11dbb366-8707-4401-ae96-0b74a041019d/dsComm.py)
10. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/d9dac957-04db-41bb-af5e-2f6c9baf3bbc/FrSmart.py](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/d9dac957-04db-41bb-af5e-2f6c9baf3bbc/FrSmart.py)