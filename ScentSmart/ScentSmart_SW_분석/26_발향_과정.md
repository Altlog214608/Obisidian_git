

# `progressBarScentAndClean(scent_no, progress_bar, label_text)` 함수 동작 상세 설명

python

`def progressBarScentAndClean(self, scent_no, progress_bar, label_text):     # 1. 명령 전달: 향 발향 및 세정 명령을 시리얼 포트로 전송한다.    self.requestScentNo(scent_no, command=dsComm.CMD_RUN_CLEAR)     # 2. 향 발향 진행 상태 표시 (프로그레스 바 갱신)    scent_time = int(dsSetting.dsParam['scent_run_time'])    for i in range(1, 101):        QtTest.QTest.qWait(scent_time * 9)  # 잠시 대기 (scent_time을 기반으로)        progress_bar.setValue(i)            # 진행바를 1%씩 차오르게 업데이트     # 3. 세정 진행 상태 표시 (프로그레스 바 스타일 변경 & 텍스트 업데이트)    label_text.setText(dsText.processText['cleaning'])    progress_bar.setStyleSheet(dsUiCustom.pb_red_style)     # 빨간색 스타일 적용 (세정 진행 중임을 시각화)     # 4. 세정 경고 사운드 재생    dsSound.playGuideSound('cleaning_caution')     # 5. 세정 진행 상태 표시 (프로그레스 바 갱신)    cleaning_time = int(dsSetting.dsParam['cleaning_run_time'])    for i in range(1, 101):        QtTest.QTest.qWait(cleaning_time * 9)  # 잠시 대기 (세정 시간 기반)        progress_bar.setValue(i)                # 진행바 1%씩 차오르게 업데이트     # 6. 세정 종료 후 프로그레스바 스타일을 파란색으로 변경 (정상 상태 표시)    progress_bar.setStyleSheet(dsUiCustom.pb_blue_style)     # 7. 발향 간격 시간 대기 (다음 발향까지 쉬는 시간)    QtTest.QTest.qWait(dsSetting.dsParam['scent_emit_interval'] * 1000)`

# 각 주요 단계별 상세 설명

## 1) 명령 전달 (`self.requestScentNo`)

- 여기에 실제 **하드웨어 향 분사기**에 명령을 보내는 부분이 있습니다.
    
- `requestScentNo()` 함수는 디지털향 장치로 **시리얼 통신 패킷 형태의 명령**을 보냅니다.
    
- 패킷은 `dsComm` 모듈의 여러 `sendMsgForEmitClean` 같은 함수에서 바이트(byte) 배열 형태로 만들어집니다.
    
- 이 바이트 패킷들은 16진수 형식이긴 하지만, 실제로는 하드웨어에 맞춘 프로토콜에 따라 구조가 정해진 데이터 블록입니다.
    
- 명령 패킷에는 향 번호(`scent_no`), 강도, 시간, 지연 등 파라미터가 포함됩니다.
    

## 2) 향 발향 프로그레스 표시

- 발향 시간이 `dsSetting.dsParam['scent_run_time']` 으로 설정되어 있고, (예: 몇 초 단위)
    
- 이 시간을 기준으로 프로그레스바(progress_bar)를 천천히 0%에서 100%까지 차오르게 만듭니다.
    
- `QtTest.QTest.qWait`는 **딜레이를 주는 함수**로, UI는 멈추지 않고 부드럽게 대기 상태와 진행 상태 변화를 보여줍니다.
    

## 3) 세정 진행 표시 및 안내 텍스트 변경

- 향 분사 후 장치 내부 청소(세정) 과정이 진행되는데,
    
- 이 때 안내 레이블(label_text)의 문구를 'cleaning' 문구로 변경하며,
    
- 프로그레스바 색상을 빨간색 스타일로 변경하여 눈에 띄게 표현합니다.
    

## 4) 세정 경고 사운드 재생

- 사용자에게 세정 시작을 알리기 위해 경고 사운드가 한 번 재생됩니다.
    

## 5) 세정 진행 프로그레스 표시

- 세정 시간이 `dsSetting.dsParam['cleaning_run_time']` 으로 설정되어 있습니다.
    
- 똑같이 프로그레스바를 0% -> 100%까지 점차 채워서 보여줍니다.
    

## 6) 세정 완료 후 프로그레스바 스타일 변경

- 청소가 완료되어 프로그레스바 색상을 다시 파란색 스타일로 변경해 정상 상태임을 나타냅니다.
    

## 7) 발향 간격 시간 대기

- `scent_emit_interval` 만큼 대기하여, 연속 발향 시 일정 간격을 유지하도록 합니다.
    

# (참고) 명령 패킷 생성 부분 (`requestScentNo` 내부 예시)

python

`def requestScentNo(self, scent_no, command):     sendMsg = dsComm.sendMsgForEmitClean(        id=1,        func=16,        address=dsComm.ADDRESS_RUN_CLEAR,        qor=8,        data_length=16,        data_command=command,        data_scent_no=scent_no,        data_scent_pump_power=dsSetting.dsParam['scent_power'],        data_clean_pump_power=dsSetting.dsParam['cleaning_power'],        data_scent_period=dsSetting.dsParam['scent_run_time'],        data_clean_period=dsSetting.dsParam['cleaning_run_time'],        data_scent_delay=dsSetting.dsParam['scent_post_delay'],        data_cleanup_delay=dsSetting.dsParam['cleaning_post_delay']    )    self.write_data(sendMsg)   # 실제 시리얼 포트에 바이트 전송`

- `dsComm.sendMsgForEmitClean` 함수가 **16진수 바이트 배열(패킷)**을 만든 뒤 반환합니다.
    
- `self.write_data()` 함수가 이 패킷을 시리얼 포트로 전송하는 역할입니다.
    

# 쉽게 비유해서 이해하기

|단계|설명|비유|
|---|---|---|
|1. 명령 전송|“향 분사 시작해!” 신호를 하드웨어에 보냄|조명 스위치 켜는 버튼 누르기|
|2. 발향 진행|UI 프로그레스바가 향 분사 진행 상태를 0~100% 보여줌|주방에서 요리 중 상태 보여주기|
|3~6. 세정 진행|향 분사 후 청소(세정) 시작, UI 색 변화 & 사운드 재생|커피 머신에서 자동 세척 진행 표시|
|7. 다음 발향 준비|다음 향 분사까지 잠시 쉬는 시간 대기|다음 손님 맞이 준비 시간|

필요하면 `dsComm.sendMsgForEmitClean` 함수 내부 구조(바이트 패킷 내용)도 설명드릴 수 있고, 실제 시리얼 전송 `write_data()` 흐름도 상세히 알려드릴 수 있습니다.  
궁금하면 알려 주세요!

1. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/ae68156a-aec7-4e3b-b07c-4c3923a5eca6/ScentSmart.py](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/ae68156a-aec7-4e3b-b07c-4c3923a5eca6/ScentSmart.py)