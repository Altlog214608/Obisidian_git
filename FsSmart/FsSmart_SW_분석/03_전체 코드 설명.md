  

## 1. 임포트 구문

  

```python

import pandas as pd

import numpy as np

from sklearn.ensemble import RandomForestClassifier

from sklearn.preprocessing import OneHotEncoder

from sklearn.compose import ColumnTransformer

from sklearn.pipeline import Pipeline

from sklearn.model_selection import train_test_split

```

  

- pandas: 표 형식의 데이터 처리 (DataFrame)

- numpy: 수치 계산 및 배열 연산

- RandomForestClassifier: 앙상블 기반 분류기

- OneHotEncoder: 범주형 데이터 전처리

- ColumnTransformer: 여러 컬럼 전처리 통합

- Pipeline: 전처리 + 모델 학습의 연결

- train_test_split: 학습/평가 데이터 분리

  

---

  

## 2. 상수 정의

  

```python

CATEGORICAL_FEATURES = ['Gender', 'Personality', 'Preferred_Scent', 'Preferred_Color', 'Price', 'Age']

MODEL_PATH = 'perfume_recommender.pkl'

```

  

- 모델 입력 컬럼 중 OneHotEncoder를 적용할 범주형 변수들

  

---

  

## 3. 함수 설명

  

### `load_data(filepath)`

  

```python

def load_data(filepath):

    return pd.read_csv(filepath)

```

  

- CSV 파일을 읽어 DataFrame 반환

  

---

  

### `build_pipeline()`

  

```python

def build_pipeline():

    preprocessor = ColumnTransformer(

        transformers=[

            ('cat', OneHotEncoder(handle_unknown='ignore'), CATEGORICAL_FEATURES)

        ],

        remainder='passthrough'

    )

    pipeline = Pipeline(steps=[

        ('preprocessor', preprocessor),

        ('classifier', RandomForestClassifier(n_estimators=100, random_state=42))

    ])

    return pipeline

```

  

- 전처리기 + 분류기 조합의 전체 파이프라인 생성

  

---

  

### `split_data(...)`

  

```python

def split_data(df, target_col='Recommend_Perfume_Id', test_size=0.2, random_state=42):

    X = df.drop(target_col, axis=1)

    y = df[target_col]

    return train_test_split(X, y, test_size=test_size, random_state=random_state)

```

  

- 데이터를 입력(X)과 정답(y)으로 나누고 학습/테스트 분할

  

---

  

### `train_model(...)`

  

```python

def train_model(pipeline, X_train, y_train):

    pipeline.fit(X_train, y_train)

    return pipeline

```

  

- 파이프라인 학습

  

---

  

### `evaluate_model(...)`

  

```python

def evaluate_model(pipeline, X_test, y_test):

    accuracy = pipeline.score(X_test, y_test)

    print("Test Accuracy: {:.2f}".format(accuracy))

    return accuracy

```

  

- 테스트 세트에 대한 정확도 평가

  

---

  

### `predict_perfume(...)`

  

```python

def predict_perfume(input_data, model_pipeline):

    try:

        input_df = pd.DataFrame([input_data])

        proba = model_pipeline.predict_proba(input_df)[0]

        return {

            'predicted_id': model_pipeline.predict(input_df)[0],

            'confidence': round(np.max(proba), 2)

        }

    except Exception as e:

        return {'error': str(e)}

```

  

- 입력 딕셔너리를 예측값과 신뢰도 추출

  

---

  

### `print_prediction_result(...)`

  

```python

def print_prediction_result(result):

    if result is None or 'error' in result:

        print("예측에 실패했습니다. 오류: {}".format(result.get('error', '알 수 없는 오류')))

    else:

        print("추천 결과:")

        print("- ID: {}".format(result['predicted_id']))

        print("- 신뢰도: {}".format(result['confidence']))

```

  

- 결과 dict를 사람이 읽기 쉬운 형태로 출력

  

---

  

### `find_scent(...)`

  

```python

def find_scent(input_data):

    df = load_data('perfume_training_df.csv')

    pipeline = build_pipeline()

    X_train, X_test, y_train, y_test = split_data(df)

    trained_pipeline = train_model(pipeline, X_train, y_train)

    evaluate_model(trained_pipeline, X_test, y_test)

    result = predict_perfume(input_data, trained_pipeline)

    print_prediction_result(result)

    return result

```

  

- 학습부터 추천까지 전체 흐름을 수행하는 대표 함수

  

---

  

### `main()` 함수

  

```python

def main():

    df = load_data('perfume_training_df.csv')

    pipeline = build_pipeline()

    X_train, X_test, y_train, y_test = split_data(df)

    trained_pipeline = train_model(pipeline, X_train, y_train)

    evaluate_model(trained_pipeline, X_test, y_test)

    sample_input = {

        'Age': 30,

        'Gender': 'Woman',

        'Personality': 'Agreeableness',

        'Preferred_Scent': 'Floral',

        'Preferred_Color': 'Yellow',

        'Price': 'Entry'

    }

    result = predict_perfume(sample_input, trained_pipeline)

    print_prediction_result(result)

```

  

---

  

### 실행 조건

  

```python

if __name__ == "__main__":

    main()

```

  

- 단독 실행 시 `main()` 함수 호출됨

  

---

  

## 요약

  

- 이 코드는 향수를 추천하기 위해 `RandomForestClassifier` 기반의 모델을 학습하고 예측하는 전체 구조를 가지고 있음.

- 사용자는 딕셔너리 형태의 입력을 넣기만 하면 추천 결과를 받을 수 있음.

- 핵심 함수: `find_scent(input_data)` 를 통해 전체 파이프라인 자동 실행